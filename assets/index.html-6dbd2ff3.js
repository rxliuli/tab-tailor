(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();function g(){const t=document.querySelector("#app");t.innerHTML='<h1 class="header">Easily customize your new tab background with videos, GIFs, or images. You can try dragging an image here or click the button in the bottom right corner to set it.</h1>'}function s(t){return new Promise((e,n)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>n(t.error)})}function y(t,e){const n=indexedDB.open(t);n.onupgradeneeded=()=>n.result.createObjectStore(e);const r=s(n);return(o,i)=>r.then(c=>i(c.transaction(e,o).objectStore(e)))}let a;function l(){return a||(a=y("keyval-store","keyval")),a}function d(t,e=l()){return e("readonly",n=>s(n.get(t)))}function u(t,e,n=l()){return n("readwrite",r=>(r.put(e,t),s(r.transaction)))}function f(t){return`
${t} {
  position: fixed;
  width: 100%;
  height: 100%;
  right: 0;
  bottom: 0;
  z-index: -100;
  object-fit: cover;
  filter: brightness(0.5);
}
`}function h(){return{name:"video",type:"video/",handle(t){const e=document.createElement("video");e.id="background-"+Date.now(),e.muted=!0,e.loop=!0,e.autoplay=!0,e.src=URL.createObjectURL(t);const n=document.createElement("style");n.innerHTML=f(`#${e.id}`),document.body.append(e,n)}}}function b(){return{name:"image",type:"image/",handle(t){const e=document.createElement("img");e.id="background-"+Date.now(),e.src=URL.createObjectURL(t);const n=document.createElement("style");n.innerHTML=f(`#${e.id}`),document.body.append(e,n)}}}const p=[b(),h()];async function m(t){var r;if(!t||t.length>1)return alert("Please drop only one file."),!1;const e=t[0],n=p.find(o=>e.type.startsWith(o.type));n&&(console.log("findPlugin",n.name),n.handle(e),(r=document.querySelector("#app"))==null||r.remove(),await Promise.all([u("plugin",n.name),u("data",e)]))}function v(){const t=document.createElement("button");return t.title="Set background from image or video",t.classList.add("floating-btn"),t.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Pro 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license (Commercial License) Copyright 2023 Fonticons, Inc. --><path d="M256 512A256 256 0 1 0 256 0a256 256 0 1 0 0 512zM232 344V280H168c-13.3 0-24-10.7-24-24s10.7-24 24-24h64V168c0-13.3 10.7-24 24-24s24 10.7 24 24v64h64c13.3 0 24 10.7 24 24s-10.7 24-24 24H280v64c0 13.3-10.7 24-24 24s-24-10.7-24-24z"/></svg>',t.addEventListener("click",()=>{const e=document.createElement("input");e.type="file",e.accept="image/*,video/*",e.addEventListener("change",async()=>{await m(e.files)}),e.click()}),document.body.append(t),t}document.addEventListener("dragover",function(t){if(t.preventDefault(),t.dataTransfer.files.length>1)return alert("Please drop only one file."),!1},!1);document.addEventListener("drop",async function(t){var e;t.preventDefault(),m((e=t.dataTransfer)==null?void 0:e.files)},!1);async function w(){const t=v(),e=await d("plugin");if(!e){t.classList.add("first"),g();return}const n=p.find(o=>o.name===e);if(!n)return;const r=await d("data");r&&n.handle(r)}w();
